// #target: x64-darwin

module foo;

struct Bar {
  int a;
}

Bar[6] bar;

fn int main()
{
    test_bar(0);
    return 0;
}

fn void test_bar(int idx)
{
    bar[idx].a = 0;
    bar[0].a = idx;
}

/* #expect: foo.ll

define void @foo.test_bar(i32 %0) #0 {
entry:
  %idx = alloca i32, align 4
  store i32 %0, i32* %idx, align 4
  %1 = load i32, i32* %idx, align 4
  %sisiext = sext i32 %1 to i64
  %2 = getelementptr inbounds [6 x %Bar], [6 x %Bar]* @foo.bar, i64 0, i64 %sisiext
  %3 = getelementptr inbounds %Bar, %Bar* %2, i32 0, i32 0
  store i32 0, i32* %3, align 4
  %4 = load i32, i32* %idx, align 4
  store i32 %4, i32* getelementptr inbounds ([6 x %Bar], [6 x %Bar]* @foo.bar, i64 0, i64 0, i32 0), align 4
  ret void
}